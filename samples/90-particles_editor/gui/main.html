<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.11.2/themes/dot-luv/jquery-ui.css">
    <style>
        body {
            padding:0;
            margin:0;
            width:100%;
        }

        #body {
            display:block;
            height:760px;
            width:333px;
            left:0;
            color:white;
            padding:0;
            margin:0;
            font-size:10px;
        }

        ul { list-style-type: none; margin: 0; padding: 0; }
        li { margin: 0 3px 3px 3px; background:none !important; }

    </style>
    <script>
        var ranges = {};
        var modifiers = {};
        var values = {};

        function updateValue(name)
        {
            gengine_execute("updateValue('" + name + "', " + values[name] + ")");
        }

        function updateRange(name)
        {
            if(ranges[name][0].constructor !== Array)
            {
                var a = ranges[name][0];
                var b = ranges[name][1];

                gengine_execute("updateRange('" + name + "',"+ a + "," + b + ")");
            }
            else
            {
                var a = ranges[name][0][0];
                var b = ranges[name][1][0];
                var c = ranges[name][0][1];
                var d = ranges[name][1][1];

                gengine_execute("updateRange('" + name + "', vector2(" + a + ", "+ b + "), vector2("+c+","+d+") )");
            }
        }

        function updateModifier(name)
        {
            var modifier = modifiers[name];
            var text = "{";

            for(var i=0;i<modifier.values.length; ++i)
            {
                var v = modifier.values[i];

                if(i>0)
                {
                    text += ", ";
                }

                if(v.constructor !== Array)
                {
                    text += v;
                }
                else if (v.length == 2)
                {
                    text += "vector2(" + v[0] + ", " + v[1] + ")";
                }
                else if (v.length == 4)
                {
                    text += "vector4(" + v[0] + ", " + v[1] + ", " + v[2] + ", " + v[3] + ")";
                }
            }

            text += "}";

            gengine_execute("updateValue('" + name + "', " + text + ")");
        }

        function updateAll()
        {
            for(var name in values)
            {
                updateValue(name);
            }

            for(var name in ranges)
            {
                updateRange(name);
            }

            for(var name in modifiers)
            {
                updateModifier(name);
            }
        }

        function createValue(name, min, max, step, v)
        {
            var code = name + ': <span id="' + name + 'Value">' + v + '</span><div id="' + name + '"></div><p/>';

            $('#emitter').append(code);

            values[name] = v;

            $( "#"+name ).slider({
                min:min,
                max:max,
                step: step,
                value: v,
                slide: function(event, ui) {
                    $('#' + name + 'Value').html(ui.value);
                    values[name] = ui.value;
                    updateValue(name);
                }
            });
        }

        function createRange(name, min, max, step, v1, v2)
        {
            var code = name + ': <span id="' + name + 'Values">' + v1 + ' - ' + v2 + '</span><div id="' + name + '"></div><p/>';

            $('#ranges').append(code);

            ranges[name] = [v1, v2];

            $( "#"+name ).slider({
                min:min,
                max:max,
                range: true,
                step: step,
                values: [v1, v2],
                slide: function(event, ui) {
                    $('#' + name + 'Values').html(ui.values[0] + " - " + ui.values[1]);
                    ranges[name] = [ui.values[0], ui.values[1]];
                    updateRange(name);
                }
            });
        }

        function createVector2Range(name, min, max, step, v1, v2)
        {
            var code = name + ':<br/>';
            code += 'x : <span id="' + name + 'Values1">' + v1 + ' - ' + v2 + '</span> <div id="' + name + '1"></div>';
            code += 'y : <span id="' + name + 'Values2">' + v1 + ' - ' + v2 + '</span><div id="' + name + '2"></div><p/>';

            ranges[name] = [[v1,v2],[v1,v2]];

            $('#ranges').append(code);

            $( "#"+name + '1' ).slider({
                min:min,
                max:max,
                range: true,
                step: step,
                values: [v1, v2],
                slide: function(event, ui) {
                    $('#' + name + 'Values1').html(ui.values[0] + " - " + ui.values[1]);
                    ranges[name][0] = [ui.values[0], ui.values[1]];
                    updateRange(name);
                }
            });

            $( "#"+name + '2' ).slider({
                min:min,
                max:max,
                range: true,
                step: step,
                values: [v1, v2],
                slide: function(event, ui) {
                    $('#' + name + 'Values2').html(ui.values[0] + " - " + ui.values[1]);
                    ranges[name][1] = [ui.values[0], ui.values[1]];
                    updateRange(name);
                }
            });
        }

        function createVec2Modifier(name)
        {
            var code = name + ': <br/>';

            code += '<ul id="' + name + '"></ul>';

            modifiers[name] = {
                values: [],
                lastId: 0,
                idToIndex: {},
                indexToId: {}
                };

            $('#modifiers').append(code);

            $("#" + name).sortable({
                start: function(event, ui) {
                    ui.item.previousIndex = ui.item.index();
                },
                stop: function(event, ui) {
                    var previousIndex = ui.item.previousIndex;
                    var index = ui.item.index();
                    if(previousIndex != index)
                    {
                        var modifier = modifiers[name];
                        var temp = modifier.values[ui.item.previousIndex];

                        modifier.values[previousIndex] = modifier.values[index];
                        modifier.values[index] = temp;

                        var previousId = modifier.indexToId[previousIndex];
                        var newId = modifier.indexToId[index];

                        modifier.indexToId[previousIndex] = newId;
                        modifier.indexToId[index] = previousId;

                        modifier.idToIndex[previousId] = index;
                        modifier.idToIndex[newId] = previousIndex;

                        updateModifier(name);
                    }
                }
                });

            $("#" + name).disableSelection();

            addModifierStep(name, 0, 4, 0.1, 1);
            addModifierStep(name, 0, 4, 0.1, 1);
            addModifierStep(name, 0, 4, 0.1, 1);
        }

        function addModifierStep(name, min, max, step, v)
        {
            var modifier = modifiers[name];

            var id = modifier.lastId + 1;

            var index = modifier.values.length;

            modifier.values.push([v, v]);
            modifier.idToIndex[id] = index;
            modifier.indexToId[index] = id;

            var code = '<li class="ui-state-default">';

            code +='x: <span id="' + name + id + 'xValue">' + v + '</span><div id="' + name + id + 'x"></div><p/>';
            code +='y: <span id="' + name + id + 'yValue">' + v + '</span><div id="' + name + id + 'y"></div><p/>';

            code += "</li>";

            $('#'+name).append(code);

            $( "#"+name+id+'x' ).slider({
                min:min,
                max:max,
                step: step,
                value: v,
                slide: function(event, ui) {
                    $('#' + name + id + 'xValue').html(ui.value);
                    modifier.values[modifier.idToIndex[id]][0] = ui.value;
                    updateModifier(name);
                }
            });

            $( "#"+name+id+'y' ).slider({
                min:min,
                max:max,
                step: step,
                value: v,
                slide: function(event, ui) {
                    $('#' + name + id + 'yValue').html(ui.value);
                    modifier.values[modifier.idToIndex[id]][1] = ui.value;
                    updateModifier(name);
                }
            });

            $("#" + name).sortable('refresh');

            modifiers[name].lastId = id;
        }

        $(function() {
            $( "#accordion" ).accordion(
                {
                    heightStyle: "fill"
                }
                );

            var pi2 = 3.1415 * 2;
            var hpi = 3.1415 / 2;

            createValue("emitterRate", 1, 2000, 1, 100);

            createRange("directionRange", -pi2, pi2, 0.05, hpi, hpi);
            createRange("speedRange", 0, 2000, 1, 10, 100);
            createRange("lifeTimeRange", 0.1, 10, 0.1, 1, 2);
            createRange("rotationRange", -pi2, pi2, 0.05, 0, 0);
            createRange("spinRange", -10, 10, 0.05, 0, 0);
            createVector2Range("extentRange",0, 256, 1, 16, 32);

            createVec2Modifier("scales");

            updateAll();
        });
    </script>
</head>

<body>
<div id="body">
    <div id="accordion">
      <h3>Emitter</h3>
      <div id="emitter">

      </div>
      <h3>Ranges</h3>
      <div id="ranges">

      </div>
      <h3>Modifiers</h3>
      <div id="modifiers">
      </div>
      <h3>Lua table</h3>
      <div>
          <textarea rows="24" cols="40">
{
    texture = gengine.graphics.texture.get("particle"),
    size = 10000,
    rate = 1000,
    emitterLifeTime = 1000,
    extentRange = {vector2(32,32), vector2(34,34)},
    lifeTimeRange = {0.5, 1},
    directionRange = {0, 2*3.14},
    speedRange = {100, 500},
    rotationRange = {0, 0},
    spinRange = {-10, 10},
    scales = {vector2(1, 1)},
    colors = {vector4(0.8,0.8,0.9,1), vector4(0.3,0.3,0.9,1), vector4(0,0,0,0)}
}
        </textarea>
      </div>
    </div>
</div>
</body>
</html>
